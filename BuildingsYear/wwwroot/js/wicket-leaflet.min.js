/** @license
 *
 *  Copyright (C) 2012 K. Arthur Endsley (kaendsle@mtu.edu)
 *  Michigan Tech Research Institute (MTRI)
 *  3600 Green Court, Suite 100, Ann Arbor, MI, 48105
 *
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 */
(function(n,t){typeof exports=="object"?module.exports=t(require("./wicket")):typeof define=="function"&&define.amd?define(["wicket"],t):t(n.Wkt)})(this,function(n){return n.Wkt.prototype.isRectangle=!1,n.Wkt.prototype.trunc=function(t){for(var r=[],i=0;i<t.length;i+=1)n.isArray(t[i])?r.push(this.trunc(t[i])):i!==0&&this.sameCoords(t[0],t[i])||r.push(t[i]);return r},n.Wkt.prototype.construct={point:function(n,t){var i=t||this.components;return i instanceof Array&&(i=i[0]),L.marker(this.coordsToLatLng(i),n)},multipoint:function(n){for(var i=[],r=this.components,t=0;t<r.length;t+=1)i.push(this.construct.point.call(this,n,r[t]));return L.featureGroup(i,n)},linestring:function(n,t){var i=t||this.components,r=this.coordsToLatLngs(i,0,this.coordsToLatLng);return L.polyline(r,n)},multilinestring:function(n){var i=this.components,t=this.coordsToLatLngs(i,1,this.coordsToLatLng);return L.multiPolyline?L.multiPolyline(t,n):L.polyline(t,n)},polygon:function(n){var t=this.trunc(this.components),i=this.coordsToLatLngs(t,1,this.coordsToLatLng);return L.polygon(i,n)},multipolygon:function(n){var i=this.trunc(this.components),t=this.coordsToLatLngs(i,2,this.coordsToLatLng);return L.multiPolygon?L.multiPolygon(t,n):L.polygon(t,n)},geometrycollection:function(n){var i,t,r;for(i=this.trunc(this.components),r=[],t=0;t<this.components.length;t+=1)r.push(this.construct[i[t].type].call(this,i[t]));return L.featureGroup(r,n)}},L.Util.extend(n.Wkt.prototype,{coordsToLatLngs:L.GeoJSON.coordsToLatLngs,coordsToLatLng:function(n,t){var i=t?n.x:n.y,r=t?n.y:n.x;return L.latLng(i,r,!0)}}),n.Wkt.prototype.deconstruct=function(t){var e,h,o,r,u,s,i,f;if(h=function(t){for(var r=[],i=0;i<t.length;i+=1)n.isArray(t[i])?r.push(h(t[i])):r.push({x:t[i].lng,y:t[i].lat});return r},t.constructor===L.Marker||t.constructor===L.marker)return{type:"point",components:[{x:t.getLatLng().lng,y:t.getLatLng().lat}]};if(t.constructor===L.Rectangle||t.constructor===L.rectangle)return i=t.getBounds(),{type:"polygon",isRectangle:!0,components:[[{x:i.getSouthWest().lng,y:i.getNorthEast().lat},{x:i.getNorthEast().lng,y:i.getNorthEast().lat},{x:i.getNorthEast().lng,y:i.getSouthWest().lat},{x:i.getSouthWest().lng,y:i.getSouthWest().lat},{x:i.getSouthWest().lng,y:i.getNorthEast().lat}]]};if((t.constructor===L.Polyline||t.constructor===L.polyline)&&(u=[],i=t.getLatLngs(),!i[0].equals(i[i.length-1]))){for(r=0;r<i.length;r+=1)u.push({x:i[r].lng,y:i[r].lat});return{type:"linestring",components:u}}if(t.constructor===L.Polygon||t.constructor===L.polygon){for(s=[],u=[],f=t.getLatLngs()[0],r=0;r<f.length;r+=1)u.push({x:f[r].lng,y:f[r].lat});if(u.push({x:f[0].lng,y:f[0].lat}),s.push(u),t._holes&&t._holes.length>0)for(u=h(t._holes),r=0;r<u.length;r++)u[r].push(u[r][0]),s.push(u[r]);return{type:"polygon",components:s}}if(t.constructor===L.MultiPolyline||t.constructor===L.MultiPolygon||t.constructor===L.LayerGroup||t.constructor===L.FeatureGroup){o=[];i=t._layers;for(e in i)i.hasOwnProperty(e)&&(i[e].getLatLngs||i[e].getLatLng)&&o.push(this.deconstruct(i[e]));return{type:function(){switch(t.constructor){case L.MultiPolyline:return"multilinestring";case L.MultiPolygon:return"multipolygon";case L.FeatureGroup:return function(){var n,i,r,u;i=!0;r=!0;u=!0;for(n in t._layers)t._layers.hasOwnProperty(n)&&(t._layers[n].constructor!==L.Marker&&(u=!1),t._layers[n].constructor!==L.Polyline&&(r=!1),t._layers[n].constructor!==L.Polygon&&(i=!1));return u?"multipoint":r?"multilinestring":i?"multipolygon":"geometrycollection"}();default:return"geometrycollection"}}(),components:function(){for(var t=[],n=0;n<o.length;n+=1)o[n].components&&t.push(o[n].components);return t}()}}t.constructor===L.Circle||t.constructor===L.circle?console.log("Deconstruction of L.Circle objects is not yet supported"):console.log("The passed object does not have any recognizable properties.")},n});